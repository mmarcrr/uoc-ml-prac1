---
title: "Algoritmo k-NN"
author: "Marc Rodriguez"
date: "10/24/2021"
output: html_document
params:
    file_in: "splice.txt"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## implementacion codificación “one-hot”

```{r one-hote}
library(stringr)

encode.onehot<-function(sequence){
codes<-c("A","G","T","C","D","N","S","R")
seq.splited<-unlist(strsplit(str_trim(sequence),""))
c(t(sapply(seq.splited,function(x){match(codes,x,nomatch=0)})))
}

nuc_seq="CCAGCTGCATCACAGGAGGCCAGCGAGCAGGTCTGTTCCAAGGGCCTTCGAGCCAGTCTG"
example<-encode.onehot(nuc_seq)
typeof(example)


```


```{r one-hote2}
library(stringr)
#seq.splited<-unlist(strsplit(nuc_seq,""))
#output<-sapply(seq.splited,function(seq){match(codes,seq,nomatch=0)})
#c(t(output))
(nuc_seq)
```


```{r read}
file1="splice.txt"
data_in <- read.csv(file.path(params$file_in), header=FALSE)
data_in
```
```{r}
summary(data_in)
```
```{r}
encode.onehot<-function(sequence){
codes<-c("A","G","T","C","D","N","S","R")
seq.splited<-unlist(strsplit(str_trim(sequence),""))
sapply(seq.splited,function(x){match(codes,x,nomatch=0)}, simplify = TRUE)
}

mysplice<-data.frame(data_in[1],data_in[2],t(apply(data_in[3],1,encode.onehot)))
colnames(mysplice)[1] <- "class"
colnames(mysplice)[2] <- "seq_name"


```


```{r}
encode.source <- function(data){
  data.frame(data[1],data[2],t(apply(data[3],1,encode.onehot)))
}

output<-encode.source(data_in)

```

```{r}
load("splice_oh.Rdata")
splice_subset<-subset(mysplice,select=-c(2,1))
```


```{r}
################## data spliting
set.seed(123) #fijar la semilla para el generador pseudoaleatorio
train<-sample(1:nrow(splice_subset),round(2*nrow(splice_subset)/3,0))
# create training and test data
out_training<-splice_subset[train,]
out_test<-splice_subset[-train,]
# create labels for training and test data
class_training<-mysplice[train,2]
class_test<-mysplice[-train,2]

```

```{r}
############### libraries loading
library(class) # knn
############## data prediction

set.seed(123456) #fijar la semilla para el inicio del clasificador

test_pred <- knn(train =out_training, test = out_test, cl = class_training, k=3)
```

```{r}
# load the "gmodels" library
library(gmodels)
# Create the cross tabulation of predicted vs. actual
############ evaluating model performance

CrossTable(x = class_test, y = test_pred , prop.chisq=FALSE)
```

